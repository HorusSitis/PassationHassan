\section{A Reduced Order Model}\label{rom}

As we have seen in previous section, computing solutions of equation \ref{chiw} for a given geometry %
can be time-expensive even, in the three-dimensional case, for an elementary cell with an euclidean bowl in its center.

\par
We notice that the geometry of some elementary cells, which is relevant for the calculus of the the homogenized tensor, %
depends of a real parameter, like the radius of a circular inclusion in the two-dimensional case, %
or the radius of a sphere or a cylinder for the third dimension.

\par
Then we can write $\chi(\mathbf{x},\rho)$ for the vector field defined on a fluid domain depending on a (set of) geometrical parameter(s) $\rho$, %
where $\rho$ can be the radius of the circle, sphere or cylinder mentioned above.

\par
Those gemetrical parameters are also linked, in an obvious way, to the cells porosity which is a physical parameter - but not the only one , %
having an influence on diffusion in a porous medium.

\par
In this section we present a method for computing, with reasonable performances, good approximations of solutions of problem \ref{chiw}, %
and then homogenized diffusion tensors for a given set of cells depending on one real parameter, using a Reduced Order Model (ROM).

\etoile
The latter consists in writing :

\begin{equation}
\label{rom_chi}
\chi(\mathbf{x},\rho)\simeq \sum\limits_{i=1}^{N_{rom}}a_i(\rho )\phi_i(\mathbf{x})
\end{equation}

where $N_{rom}$ is a positive integer chose to be small, $a_i$ are scalar-valued functions of $\rho )$ %
and the $\phi_i -$s an orthogonal family of functions of space or \emph{spatial modes}, defined on the domain where $\chi (\rho ,\cdot)$ lives.

\par
The original problem \ref{chiw} which $\chi (\cdot,\rho )$ must satisfy can be, with good approximation, rewritten as a linear system of size $N_{rom}\times N_{rom}$, %
using the so-called Galerkin projection.

\ligneinter
In subsection \ref{pod_rom}, we present the construction of the Reduced Order Model (ROM) for a general family of functions $(w(\mathbf{x},\tau))_{\tau}$, %
which relies on Proper Orthogonal Decomposition (POD) with the real parameter $\tau$.

\par
For POD, we focus on the \emph{method of snapshots}, and give the general algorithm we use for its implementation.

\par
In subsection \ref{rom_chi}, we present our method for computing and resolving a Reduced Order Model for periodic homogenization, %
and we illustrate the construction with the case of an elementary cell with a single circular solid inclusion, %
taking the radius of the disc for parameter.

\subsection{An algorithm for POD-ROM}\label{pod_rom}

Let's $w(\mathbf{x},\tau)$ be the general solution of the following problem :

\begin{equation}\label{genp}
\mathcal{A}^{\mathbf{x},\tau}\left(w(\mathbf{x},\tau)\right)=f(\mathbf{x},\tau)
\end{equation}

with $\mathcal{A}^{\mathbf{x},\tau}$ could be a differential operator, %
and $f$ a function, both depending on \emph{continuous} variables $\mathbf{x}$ and $\tau$.

\par
For Navier-Stokes equation among other problems from physics, parameter $\tau$ will be the time ; %
for periodic homogenization $\mathcal{A}$ is a differential operator in $\mathbf{x}$ which depends on $\tau$.

\etoile
Moreover, every spatial function $w(\cdot,\tau)$ for a given $\tau$ is supposed to lie in an Hilbert space $H$, %
typically $\mathcal{L}^2$ of $H^1$ ; this space would also be euclidean, or generated by a Finite Element basis.

\subsubsection{Proper Orthogonal Decomposition (POD)}
%\ligneinter

In purpose of resolving \ref{genp} we begin to seek for the decomposition :

\begin{equation}\label{POD}
w(\mathbf{x},\tau)=\sum\limits_{i=1}^{N_{POD}} a_i(\tau)\phi_i(\mathbf{x})
\end{equation}

$N_{POD}$ is an integer lesser than the dimension of $H$ if this space is Euclidean, %
and $+\infty$ when $H$ is a separable Hilbert space.

\par
We notice that we already have separation of variables $\mathbf{x}$ and $\tau$, like in the Reduced Order Model we are looking for.

\ligneinter
Formally, if we are given a finite set $(w(\mathbf{x},\tau_j))_j$ of functions in $\mathbf{x}$ parametrized by a collection of real numbers $(\tau_j)$, %
coming from numerical simulations performed \og{} offline \fg{} or experimental results, we are looking for a vector basis of modes lying in %the subspace of 
$H$ %generated by the $w(\cdot,\rho_i)$ %
satisfying the conditions :

\begin{itemize}
\item $w(\mathbf{x},\tau_j)=\sum\limits_i a_i(\tau_j)\phi_n(\mathbf{x})$ for all $j$ and $\mathbf{x}$ ;
\item The $\phi_j$ are orthogonal ;
\item $\phi_l= \arg\max\limits_{\phi_j\in H}\left\langle\left(\phi_j\left|\sum\limits_{k=1}^{l-1}\left(w|\phi_k\right)_H\phi_k\right.\right)_H\right\rangle$ ; %
$\langle \ \rangle$ beeing the average operator over the $\tau_j-$s.
\end{itemize}

\par
The $\phi_i$ are functions depending on $\mathbf{x}$ called \emph{spatial modes}, which lie in $H$. %
The coefficient $a_i(\tau)$ is the individual projection of $w(\cdot,\tau)$ in this basis, %
and the set $(a_i)_i$ will constitute the Reduced Order Model.

\par
The last condition ensures that the POD base is optimal in the sense that for all $j$ smaller than the rank $N_{POD}$ of the basis $\Phi$, i. e. %$(\phi_i)$, %
%the average projection of the $w(\cdot , \tau_j)$ is maximal ; %
space $[\phi_i]_{i=1}^{l}$ gives the best approximation of $w(\mathbf{x},\tau_j)$ among the subspaces of $H$ with rank $l$.

%\subsubsection{The Fredholm Integral Equation}
\ligneinter
We suppose we have a sample $w(\cdot,\tau_j)_j$ of spatial functions, which must be written in some POD base.

\par
The above optimisation problen in $(\phi_i)$ - we eventually write $\Phi$ for this base, %
can be formulated with lagrangian formalism, and is equivalent to the proper-value problem :

\begin{equation}\label{fred}
\int\limits_{\Omega}R(x,x')\phi_j (x)\text{d}x'=\lambda_j \phi_j (x)
\end{equation}

where :
\begin{itemize}
\item $\Omega$ is the space on which the functions $w(\cdot ,\tau_j)$, $\phi_i$ are defined ;
\item $\forall (x,x')\in\Omega^2 , R(x,x')=\left\langle w(x,\tau)w(x',\tau)\right\rangle$ or in the same way $R(x,x')=\frac{1}{N_{\tau}}\sum\limits_{j=1}^{N_{\tau}} w(x,\tau_j)w(x',\tau_j)$.
\end{itemize}

$R(x,x')_{x,x'}$, or $\mathcal{R}$, is the \emph{tensor of spatial correlations}. %
\ref{fred}, which is called Fredholm equation, can also be written :

\[\mathcal{R}\star_{\mathbf{x}}\phi_i=\lambda_i\phi_i\text{ where $\star_{\mathbf{x}}$ is the contracted product of $\mathcal{R}$ and $\phi_j$}\]

\etoile
When we do numerical calculus, the problem is formulated with a finite space $\Omega$, %
and the tensor $\mathcal{R}$ is a matrix of shape $N_x\times N_x$, $N_x :=|\Omega|$.

\par
The point is that, for practical purposes, $R(x,x')$ is a full-size matrix, with $N_x$ so large that the problem in $\lambda_i$ wouldn't be resolved ; %
this is the case in the problem of periodic homogenization.

\subsubsection{The Method of snapshots}

In this paragraph, we make some hypotheses :

\begin{enumerate}[label=(Snap \arabic*)]
\item\label{hs1} $N_{\tau}\ll N_x$ ;
\item\label{hs2} The $w(\cdot , \tau_j)$ are linearly independent in $H$ ;
\item\label{hs3} For all $j$, $\phi_i(\mathbf{x})=\sum\limits_{j=1}^{N_{\tau}}\alpha_i(\tau_j) w(\mathbf{x},\tau_j)$.
\end{enumerate}

The $N_{\tau}$ spatial functions $w(\mathbf{x}, \tau_j)$ are called the \emph{snapshots}, a few of them should be enough to build a POD.

\par
Notice that the last hypothesis entails the POD basis contains a finite number $N_{POD}$ of vectors, and that $N_{POD}\leq N_{\tau}$.

\par
By construction, $\Phi$ depends on the data $w(\mathbf{x},\tau_j)$ and is'nt supposed to be universal, as can be the Fourier basis of a $\mathcal{L}^2$ space. %
Here, $\Phi$ is also supposed to be finite, and its cardinal is bounded by the size $N_{\tau}$ of the sample :

%\[\phi_i(\mathbf{x})=\sum\limits_{j=1}^{N_t}\alpha_i^j w(\mathbf{x},\tau_j)\]

Using Fubini theorem, Fredholm equation can be rewritten :

\begin{equation}\label{tenct}
\alpha_i\star_{\tau}\mathcal{C}\star_{\tau}w(\mathbf{x},\cdot)=\lambda_i\alpha_i\star_{\tau}w(\mathbf{x},\cdot)
\end{equation}

where :
\begin{itemize}
\item $\mathcal{C}$ is the temporal-correlation tensor : $\displaystyle C(\tau,\tau ')=\dfrac{1}{N_{\tau}}\int w(\mathbf{x},\tau)w(\mathbf{x},\tau')\text{d}\mathbf{x}$ ;
\item $\star_{\tau}$ is the contracted product, with respect to the parameter $\tau$ : here, an integral on $\tau$ is a finite sum $\sum\limits_{j=1}^{N_{\tau}}$.
\end{itemize}

Since \ref{hs2}, equation \ref{tenct} gives the following problem in $(\lambda_j , \alpha_j)$ :

\begin{equation}\label{tenct}
\mathcal{C}\star_{\tau}\alpha_i\mathbf=\lambda_i\alpha_i
\end{equation}

which is analogous to the linear-algebra problem we found in the last paragraph.

\par
The matrix $C(\tau_j,\tau_j^{'})$ is symmetric positive. Solutions $\alpha_i$ of the problem are, by consequence, %
orthogonal. Formula \ref{hs3} gives :

\[{\alpha^{\ast}}_j^i\phi_i(\cdot )=w(\cdot ,\tau_j)\text{ where ${\alpha^{\ast}}_j^i=\alpha_i(\tau_j)$}\]

Since now we write : $\alpha^{\ast}==a$, we obtain the time-dependent coefficient we were looking for in POD :

\[w(\mathbf{x},\tau_j)=\sum\limits_{i=1}^{N_{POD}}a_i(\tau_j)\phi_i(\mathbf{x})\text{ for all $\mathbf{x}$}\]

with $a_i(\tau_j)$ given by : $a_i(\tau_j)=\alpha_i (\tau_j)$.

\ligneinter
Some characteristics of the method of snapshots given in this paragraph then are :

\begin{itemize}
\item The basis $\Phi$ we obtain has a small number of components, equal to $N_{\tau}$ ;
\item $\Phi$ lies in the space generated by the snapshots ;
\item $\Phi$ is orthogonal and $(\phi_n |\phi_m)=\lambda_m\delta_{mn}$ for all $m$ and $n$ :
\item $\Phi$ satisfies the optimality condition for the POD in the space generated by the $w(\cdot , \tau_j)$, but isn't supposed to be universal for functions in the general $H$ ;
\item With this method, we obtain the $\tau-$ dependent coefficients $a_i$ or $\alpha_i$, then the POD basis. 
\end{itemize}

\ligneinter
Notice that, when the function $w(\mathbf{x},\tau)$ satisfies a linear condition in $\mathbf{x}$, %
like a linear partial differential equation or a homogen boundary condition, %
we can put these functions in an Hilbert space which elements all satisfy the same relations, %
then the above reasonment leads us to build a basis $\Phi$ whose vectors are solutions of the same problem.

\subsubsection{Choosing a first few modes of the POD basis}

As the $\Phi$ found for POD is orthogonal, we can consider the question of the energy contained in a subset of the basis, %
in the sense of the norm - euclidean, $L^2$, $H^1$ \dots - of the projection on a subspace generated by this collection of spatial modes. %
Indeed, optimality of $\Phi$ entails that a first few vectors of the POD basis contain substantial information on the entire vamily, %
and then of the parametrized set of functions $w(\cdot ,\tau)_{\tau}$ of our physical problem.

\par
The following algorithm is the method of snapshots, combined with the choice of a first few vectors of the optimal orthogonal basis. %
The latter provides us the Reduced-Order Model, which matters in the next paragraph.

\begin{algo}\label{a_snap}
\begin{enumerate}
\item Select a sample $w(\mathbf{x},\tau_j)$ of $\mathbf{x}$-dependent functions, %
they can be experimental measurements or numerical simulation ;
\item Compute the \og{}time-\fg{} correlation matrix $C(\tau_j ,\tau_{j'})$ ;
\item Find the proper values and vectors of $[C]$, which is supposed to be small ;
\item\label{so1} Sort the proper-values $\lambda_i$ in a decreasing order ;
\item Compute the $\phi_i$ using the proper vectors found for $[C]$ ;
\item\label{so2} Evaluate the energy contained in each mode : $Ener^i:=\dfrac{\sum\limits_{k=1}^i\lambda_k}{\sum\limits_{k=1}^{N_{POD}}\lambda_k}$ ;
\item\label{so3} Choose the first $N_{rom}$ for which $Ener^i >\nu$, where $\nu$ is the energy threshold we want - typically, $99,99\%$ ;
\item\label{so4} Compute the approximation error with the subset $(\phi_i)_{i=1}^{N_{rom}}$.
\end{enumerate}
\end{algo}

Steps \ref{so1}, \ref{so2}, \ref{so3} and \ref{so4} have been added to the snapshot method.

\par
For practical purpose, $N_{rom}$ will be small as a consequence of the optimality of $\Phi$. %
Thus, we obtain the following decomposition which accuracy is determined by $\nu$ :

\begin{equation}
\label{red_pod}
w(\mathbf{x},\tau_j)\simeq\sum\limits_{i=1}^{N_{rom}} a_i(\tau_j)\phi_i(\mathbf{x})
\end{equation}

for all $j$.

\subsubsection{The Reduced Order Model (ROM)}

We write formula \ref{red_pod}, with the general parameter $\tau$ :

\begin{equation}
w(\mathbf{x},\tau)\simeq\sum\limits_{i=1}^{N_{rom}} a_i(\tau)\phi_i(\mathbf{x})
\end{equation}

Combining this decomposition - we write $=$ in the place of $\simeq$ and add a remainder to have an exact formula - with equation \ref{genp} we get :

\[%
\mathcal{A}\left(\sum\limits_{k=1}^{N_{rom}} a_k(\tau)\phi_k(\mathbf{x})\right) %
= f\left(\mathbf{x},\tau\right) + \mathcal{R}_{N_{rom}}(\mathbf{x},\tau)%
\]

where the $a_k$ are $N_{rom}$ functions of the parameter $\tau$, solution of the Reduced Order Model.

\etoile
In the following, we make the hypothesis that remainder $\mathcal{R}_{N_{rom}}(\mathbf{x},\tau)$ is orthogonal to the modes $\phi_i$ for all $\tau$.

\par
Galerkin projection along the $i-$th spatial mode of the above problem is written :

\[%
\left(\left.\mathcal{A}\left(\sum\limits_{k=1}^{N_{rom}} a_k(\tau)\phi_k(\mathbf{x})\right) \right|\phi_i\left(\mathbf{x}\right)\right)_H %
= \left(f\left(\mathbf{x},\tau\right)|\phi_i(\mathbf{x})\right)_H%
\text{ for all $i$ in $1,\dots , k$}%
\]

\par
The above projection of the strong problem \ref{genp} gives us a system of $N_{rom}$ equations, each involving the $N_{rom}$ coefficient functions $a_k$ %
that are known for the set of values $\tau_j$, which must be much easier to resolve than the original problem and will give us, %
in practical cases, a very good approximation of the parametrized function $w(\mathbf{x},\tau)$.

\etoile
We can also use Galerkin projection for a weak problem, that's we are doing in the following subsection for \ref{chiw}.

\subsection{Back to periodic homogenization}\label{rom_chi}

%\etoile
In this section, we define a ROM of the system \ref{chiw} using the so-called Galerkin projection on the basis $(\phi_i)_{i=1}^{N_{rom}}$.

One more step is however required for our purpose.

\par
Indeed, the snapshot $\chi_j$ that we use in our model construction is solution of \ref{chiw} on the fluid domain in %
the elementary cell defined with the geometrical parameter $\rho_j$, %
which we have seen can be the radius of an two-dimensional disc, an three-dimensional sphere etc. %
This disc, cylinder, \dots itself is a subset of the solid domain $\Omega_s$ of the inclusion.

\par
Thus, the function $\chi(\mathbf{x},\rho_j)$ is defined for $\mathbf{x}$ in a $\Omega_f$ space which depends on the parameter $\rho$.

\begin{figure}[H]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\subfloat[$D_k^{hom}=0.9845$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/sol_1_sur8cer_un_ray.png}}%
&%
\subfloat[$D_k^{hom}=0.9391$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/sol_2_sur8cer_un_ray.png}}%
&%
\subfloat[$D_k^{hom}=0.8680$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/sol_3_sur8cer_un_ray.png}}%
&%
\subfloat[$D_k^{hom}=0.7767$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/sol_4_sur8cer_un_ray.png}}%
\\
\hline
\subfloat[$D_k^{hom}=0.6716$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/sol_5_sur8cer_un_ray.png}}%
&%
\subfloat[$D_k^{hom}=0.5585$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/sol_6_sur8cer_un_ray.png}}%
&%
\subfloat[$D_k^{hom}=0.4415$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/sol_7_sur8cer_un_ray.png}}%
&%
\subfloat[$D_k^{hom}=0.3221$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/sol_8_sur8cer_un_ray.png}}%
\\
\hline
\end{tabular}
\end{center}
\caption{The vector fields $\chi(\mathbf{x},\rho_j )$}
\end{figure}

Notice that $D_k^{hom}$ is the same we computed for a centered circular inclusion. %
These results confirm that periodic microstructures with one circular inclusion, wether it lies at the center or the vertices of the elementary cell, are equivalent.

\etoile
We begin the construction of our Reduced Order Model by extrapolating the snapshots $\chi(\mathbf{x},\rho_j)_j$, defined on the collection of domains $\Omega_f^j$, %
on a same functional space $H^0$, namely the space of functions defined on the fluid domain $\Omega_f^0$ which satisfies $\rho=0$, %
with the norm used for the spaces of the snapshots ; %
the Hilbert space $H^0$ which appears in the prewious paragraph is typically $\mathcal{L}^2\left(\Omega_f^{\rho=0}\right)$.

\par
The following commands are written in FEniCS 2018.1.0 to obtain the snapshots :

\begin{codef}
\# \ packages required for POD-ROM\\
import numpy\\
from fenics import $\ast$\\
from dolfin import $\ast$\\
from mshr import $\ast$\\
\# \ generation of the snapshots\\
for j in 1\dots 8\\
\ chi\_j=Function(V\_j)\\
\ chi\_j=\emph{load $\chi(\mathbf{x},\rho_j)$}\\
\ \dots \\
\ chi\_j.set\_allow\_extrapolation(True)\\
\ chi\_j\_prime=interpolate(chi\_j,V\_fixe)\\
\ \dots \\
\ \emph{save snapshot $\chi'(\mathbf{x},\rho_j)$}
\end{codef}

where \begin{code}V\_fixe\end{code} and \begin{code}V\_j\end{code} are vector function spaces on fluid domains $\Omega_f^0$ and $\Omega_f^j$ respectively.

\begin{figure}[H]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/snap_1_sur8cer_un_ray.png}%
&%
\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/snap_2_sur8cer_un_ray.png}%
&%
\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/snap_3_sur8cer_un_ray.png}%
&%
\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/snap_4_sur8cer_un_ray.png}%
\\
\hline
\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/snap_5_sur8cer_un_ray.png}%
&%
\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/snap_6_sur8cer_un_ray.png}%
&%
\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/snap_7_sur8cer_un_ray.png}%
&%
\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/snap_8_sur8cer_un_ray.png}%
\\
\hline
\end{tabular}
\end{center}
\caption{The extrapolated snapshots}
\end{figure}

%\par
Then we compute a POD basis $\phi_i^0(\mathbf{y})$, for $\mathbf{y}$ in $\Omega_f^0$, with algorithm \ref{a_snap}. %
The $\phi_j$ modes will satisfy the partial differential equation \ref{chiw} ; %with the periodicity and average value condition.
they will also satisfy periodicity and mean-value conditions of strong problem \ref{chistr} if they are regular enough.

\begin{figure}[H]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\subfloat[$\phi_1$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_1_cer_un_ray.png}}%
&%
\subfloat[$\phi_2$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_2_cer_un_ray.png}}%
&%
\subfloat[$\phi_3$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_3_cer_un_ray.png}}%
&%
\subfloat[$\phi_4$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_4_cer_un_ray.png}}%
\\
\hline
\subfloat[$\phi_5$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_5_cer_un_ray.png}}%
&%
\subfloat[$\phi_6$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_6_cer_un_ray.png}}%
&%
\subfloat[$\phi_7$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_7_cer_un_ray.png}}%
&%
\subfloat[$\phi_8$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_8_cer_un_ray.png}}%
\\
\hline
\end{tabular}
\end{center}
\caption{The whole POD basis}
\end{figure}

%\etoile
%Once we have computed the POD basis, and chosen the smallest number $N_{rom}$ of modes for which energy exceeds $99,99\%$ of all spatial modes $\phi_i$. %

\begin{figure}[H]
\begin{center}
\begin{tabular}{|c|c|}
\hline
\subfloat[$\lambda_j$, logarithmic scale]{\includegraphics[width=0.45\linewidth,height=3.5cm]{../Figures2D/ener_vp_cer_un_ray.png}}
&%\hfill
\subfloat[Increasing cumulated eigenvalues]{\includegraphics[width=0.45\linewidth,height=3.5cm]{../Figures2D/ener_cumul_vp_cer_un_ray.png}}
\\
\hline
\end{tabular}
\end{center}
\caption{Representativity of POD modes : eigenvalues $\lambda_j$}
\label{2d_mesh}
\end{figure}

We can see that the snapshots essentialy belong to a two-dimensional real vector space.

\par
For a threshold of $99,99\%$, $N_{rom}$ is taken to be $5$. %
Thus we have the constituents of our reduced order model.

\ligneinter
Let us write :

\[\chi^0\left(\mathbf{y},\rho\right)\text{ for all $\mathbf{y}$ in the fluid domain $\Omega_f^0$ and all meaningful $\rho$}\]

\par
Galerkin projection of \ref{chiw}, with respect to the components of the test vector field $v(\mathbf{y})$, is written :

\begin{equation}\label{morchiz}
\sum\limits_{k=1}^{N_{rom}} a_k(\rho)\int\limits_{\Omega}Tr\left(\langle grad_y\phi_k^0 \left(\mathbf{y},\rho\right)|grad_y\left(\phi_i^0(\mathbf{y}\right)\rangle\right)\text{d}\Omega+%
\int\limits_{\Gamma_{sf}}\langle n_{sf}|\phi_i^0(\mathbf{y})\rangle \text{d}s %
=0
\end{equation}

where $\langle |\rangle$ is the scalar product in the two- or three-dimensional space which contains the elementary cell.

\par
This problem is simple because it is linear and involves a small number of $a_k$ functions.%, and can be resolved with any programming language with a reasonable linear algebra library. %
%In this work we will use the numpy module of Python3, so we can directly use the snapshots computed with FEniCS.

%\par
%Solutions $a_k(\rho)$, for $k$ from $1$ to $N$, are used to construct a $\chi^0\left(\mathbf{y},\rho\right)$ function of the spatial variable $\mathbf{y}$, %
%on the artificial fluid domain $\Omega_f^0$, for each possible $\rho$ characterizing an elemntary cell with solid inclusion.

\etoile
Let now $\rho^{new}$ be an a parameter, which is not one of the $\rho_j$ parameters of the snapshots, %
we want to compute $\chi(\mathbf{y},\rho^{new})$ in the fluid domain $\Omega_f^{new}$ of the cell with solid inclusion of size $\rho^{new}$.

%\par
%However, our approach is a little different because the meaningful fluid domain, for a given parameter $\rho$, %
%is not $\Omega^0$ but includes, as a part of the cell's solid domain, an area or volume depending on the value of $\rho$, %
%which is not zero.

\par
%We begin with extrapolating the modes $\phi_i^0(\mathbf{y})$, defined for $\mathbf{y}$ in the fluid domain $\Omega_f^0$. %
%In this purpose, %
We reverse the transformation, from the functional space $H^{new}$ to $H^0$, %
analogous to the interpolation that has been unsed to map the $\chi(\cdot,\rho_j)$ to the POD-relevant snapshots $\chi (\cdot ,\rho_j)$.

\par
The following commands in FEniCS 2018.1.0 generate the $N_{rom}$ $\phi_i^{new}$ modes on the fluid domain $\Omega_f^{new}$.

\begin{codef}
for i in 1\dots $N_{rom}$\\
%
\ phi\_i\_new=Function(V\_new)\\
\ phi\_i\_fixe=Function(V\_fixe)\\
\ phi\_i\_fixe=\emph{load $\phi_i$}\\
\ \dots \\
\ phi\_i\_fixe.set\_allow\_extrapolation(True)\\
\ phi\_i\_new=interpolate(phi\_i\_fixe,V\_new)\\
\ \dots \\
\ \emph{save mode $\phi_i^{new}$}
\end{codef}

where \begin{code}V\_fixe\end{code} and \begin{code}V\_new\end{code} are vector function spaces on fluid domains $\Omega_f^0$ and $\Omega_f^{new}$ respectively.

%\par
%The following packages are required for thees commands :

\begin{figure}[H]
\begin{center}
\begin{tabular}{|c|c|c|c|}
\hline
\subfloat[$\phi_1^{new}$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_nouv_1_cer_un_ray.png}}%
&%
\subfloat[$\phi_2^{new}$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_nouv_2_cer_un_ray.png}}%
&%
\subfloat[$\phi_3^{new}$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_nouv_3_cer_un_ray.png}}%
&%
\subfloat[$\phi_4^{new}$]{\includegraphics[width=0.2\linewidth, height=2.2cm]{../Figures2D/phi_nouv_4_cer_un_ray.png}}%
\\
\hline
\end{tabular}
\end{center}
\caption{The four modes needed for $\nu =99,99\%$, defined on $\Omega_f^{new}$}
\end{figure}

%\par
We resolve the \ref{morchiz} look-alike system with the basis $(\phi_i^{new})_i$ obtained with this transformation :

\begin{equation}
\sum\limits_{k=1}^{N_{rom}} a_k(\rho^{new})\int\limits_{\Omega}Tr\left(\langle grad_y\phi_k^{new} \left(\mathbf{y},\rho\right)|grad_y\left(\phi_i^{new}(\mathbf{y}\right)\rangle\right)\text{d}\Omega+%
\int\limits_{\Gamma_{sf}}\langle n_{sf}|\phi_i^{new}(\mathbf{y})\rangle \text{d}s %
=0
\label{morchi}
\end{equation}

and obtain the physically-relevant $a_k -$s, which are not the same than in \ref{morchiz}.

\par
The $\chi(\mathbf{y},\rho^{new})$ we were looking for is simply the linear combination of the $\phi_i^{new}$ given by :

\begin{equation}\label{newrom}
\chi\left(\mathbf{y},\rho^{new}\right)=\sum\limits_{i=1}^{N_{rom}} a_i \left(\rho^{new}\right)\phi_i^{new}(\mathbf{y})\text{ for all $\mathbf{y}$ in $\Omega_f^{new}$}
\end{equation}

\par
If we write problem \ref{morchi} with the vector functions we compute with FEniCS, %
we get a discrete and linear problem in the $a_i-$s for any $\rho^{new}$ ; %
in this work we use the numpy module of Python3 for this purpose, thus we can immediately use the results from FEniCS.

%\par
%We use the reduced order model the next section to compute numerically the vector $\chi$ in the configurations seen in section \ref{hom_d}, %
%varying the parameter $\rho$ ; we also give the values of the homogenized tensor obtained with the reduced model.

\par
Afterwards we compare performances and accuracy of the method, with the computation of the same $\chi$ and diffusion tensor using the Finite Element Method.

%\par
%The following plot gives respectively the solution of ROM, and the solution computed with Finite Element Method, %
%for the problem in $\chi$ with $\rho^{new}=0.22$, %
%and the values of $D^{hom}$ we obtain in each case.

\begin{figure}[H]
\begin{center}
\begin{tabular}{|c|c|}
\hline
\subfloat[ROM, $D_k^{hom}=0,7511$]{\includegraphics[width=0.45\linewidth, height=5.3cm]{../Figures2D/solROM_cer_un_ray22.png}}%
&%
\subfloat[FEM, $D_k^{hom}=0,7361$]{\includegraphics[width=0.45\linewidth, height=5.3cm]{../Figures2D/solFEM_cer_un_ray22.png}}%
\\
\hline
\end{tabular}
\end{center}
\caption{$\chi(\mathbf{x},\rho^{new})$ with $\rho^{new}=0.22$ : porosity $=0,8479$}
\end{figure}

The relative error between Reduced Order Model and Finite Element Method $D_k^{hom}$ is $2,05\%$.

\par
In this case, namely a two-dimensional circular centered inclusion meshed with $202432$ nodes, %
ROM versus FEM isn't interesting as far as the time of execution is concerned : %
computation take respectively 16 seconds and 21 seconds for a CPU of 2,90 GHz.

\ligneinter
Let us summarize the steps we follow in this work, and that we implement with Python3 and FEniCS.

\begin{algo}\label{a_rom}
\begin{enumerate}[label=\textbf{S \hspace{-7pt} \Roman*}]
\item Compute the $\chi\left(\mathbf{y},\rho_j\right)$ vector fields in $\mathbf{y}$, for a finite and small number of parameters $\rho_j$, %
using Finite Element Method ;
\item Map the $\chi (\cdot,\rho_j)$ from their respective fluid domain to the single $\Omega_f^0$, we obtain a collection of snapshots $(\chi^0(\mathbf{y},\rho_j)$ %
defined for $\mathbf{y}$ in $\Omega_f^0$ ;
\item With algorithm \ref{a_snap}, compute the $\phi^0_i$, for integer $i$ between $1$ and some $N_{rom}$ depending on the energy fraction we want for our model, typically $99,99\%$ ;
\item Reduced Order Model : we choose a new parameter $\rho^{new}$.
\begin{enumerate}[label=(\textbf{se}\ \roman*)]
\item Map the $\phi_i^0$ to the space $H^{new}$ of functions defined on the domain $\Omega_f^{new}$, with the norm $L^2$, $H^1$ etc we have chosen for our work ;
\item Resolve the Reduced Order Model with the modes $\phi_i^{new}$ and obtain the expression of $a_i(\rho)$, for every real parameter $\rho$ ;
\item Compute $\chi(\mathbf{y},\rho^{new})$ using formula \ref{newrom} ;
\item Integrate the vector field on domain $\Omega_f^{new}$ to obtain $D_k^{hom-new}$ ;
\item[Optional] Compare performances with the computation of $\chi(\mathbf{y},\rho^{new})$ using Finite Element Method : %
time of execution, accuracy.
\end{enumerate}
\end{enumerate}
\end{algo}

\medskip
For practical purpose, the first three steps will be executed offline, with a sample of microstructures not relevant for the situation. %
The last step consists in the computation online, which is supposed to be fast thanks to the Reduced Order Model, %
of an homogenized property, here the difffusion tensor, wanted for a given cemtarious material.
The calculus using the time-expensive, Finite Element Mehod, is performed once and for all.