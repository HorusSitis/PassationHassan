\section{A Reduced Order Model}\label{rom}

As we have seen in the previous section, computing solutions of equation \ref{chiw} for a given geometry, %
even, in the three-dimensional case, for an elementary cell with an euclidean bowl in its center.

\par
We notice that the geometry of some elementary cells, which is relevant for the calculus of the the homogenized tensor, %
depends of a real parameter, like the radius of a circular inclusion in the two-dimensional case, %
or the radius of a sphere or a cylinder for the third dimension.

\par
Those gemetrical parameters are also linked, in an obvious way, to the cells porosity which is a physical parameter - but not the only one , %
having an influence on diffusion in a porous medium.

\par
In this section we present a method for computing, with reasonable performances, good approximations of solutions of problem \ref{chiw}, %
and then homogenized diffusion tensors for a given set of cells depending on one real parameter, using a Reduced Order Model (ROM).

\etoile
This method relies on a Proper Orthogonal Decomposition (POD) : in a problem depending on a spatial variable $\mathbf{x}$ and a parameter $\tau$, %
which is often time, we write a decomposition of the general solution of a problem, typically a partial differential equation with boundary condition.

\par
If we write $w(\mathbf{x},\tau)$ the general solution of the spatial $\mathbf{x},\tau-$problem, typically Navier-Stokes equation or %\ref{} \cite{}
the Proper Orthogonal Decomposition is the following :

\begin{equation}\label{POD}
w(\mathbf{x},\tau)=\sum\limits_{i=1}^{N_{POD}} a_i(\tau)\phi_i(\mathbf{x})
\end{equation}

$N_{POD}$ is an integer lesser than the dimension of $H$ if this space is Euclidean, %
and $+\infty$ when $H$ is a separable Hilbert space.

\par
The above equality, will be true, at least in a good approximation, for an arbitrary parameter $\tau$.

\ligneinter
Every spatial function $w(\cdot,\tau)$ for a given $\tau$ is supposed to lie in an Hilbert space $H$, %
typically $\mathcal{L}^2$ of $H^1$ ; this space would also be euclidean, or generated by a Finite Element basis.

\par
Then $\phi_i$ are functions depending on $\mathbf{x}$ called \emph{spatial modes}, and form an orthogonal family in $H$. %
The coefficient $a_i(\tau)$ is the individual projection of $w(\cdot,\tau)$ in this basis, %
and the set $(a_i)_i$ will constitute the Reduced Order Model.

\ligneinter
Formally, if we have a given and a finite set $(w(\mathbf{x},\rho_j))_j$ of functions in $\mathbf{x}$ parametrized by a collection of real numbers $(\rho_j)$, %
coming from numerical simulations performed \og{} offline \fg{} or experimental results, we are looking for a vector basis of modes lying in %the subspace of 
$H$ %generated by the $w(\cdot,\rho_i)$ %
satisfying the conditions :

\begin{itemize}
\item $w(\mathbf{x},\tau_j)=\sum\limits_i a_i(\tau_j)\phi_n(\mathbf{x})$ for all $j$ and $\mathbf{x}$ ;
\item The $\Phi_j$ are orthogonal ;
\item $\phi_l= \arg\max\limits_{\phi_j\in H}\left\langle\left(\phi_j\left|\sum\limits_{k=1}^{l-1}\left(w|\phi_k\right)_H\phi_k\right.\right)_H\right\rangle$ ; %
$\langle \ \rangle$ beeing the average operator over the $\tau_j-$s.
\end{itemize}

The last condition ensures that the POD base is optimal in the sense that for all $j$ smaller than the rank $N_{POD}$ of the basis $\Phi$, i. e. $(\phi_i)$, %
the average projection of the $w(\cdot , \tau_j)$ is maximal ; %
space $[\phi_i]_{i=1}^{l}$ gives the best approximation of $w(,)$ among the subspaces of $H$ with rank $l$.

\etoile
Finally, we will use the \ref{POD} and the general equation \ref{chiw} to compute a vector $\chi(,\rho^{new})$ for an arbitrary parameter $\rho^{new}$, %
without the Finite Element Method.

\subsection{Proper Orthogonal Decomposition, snapshot method}

\subsubsection{The Fredholm Integral Equation}

We suppose we have a sample $w(\cdot,\tau_j)_j$ of spatial functions, which must be written in some POD base.

\par
The above optimisation problen in $(\phi_i)$ - we eventually write $\Phi$ for this base, %
can be formulated with lagrangian formalism, and is equivalent to the proper-value problem :

\begin{equation}\label{fred}
\int\limits_{\Omega}R(x,x')\phi_j (x)\text{d}x'=\lambda_j \phi_j (x)
\end{equation}

where :
\begin{itemize}
\item $\Omega$ is the space on which the functions $w(\cdot ,\tau_j)$, $\phi_i$ are defined ;
\item $\forall (x,x')\in\Omega^2 , R(x,x')=\left\langle w(x,\tau)w(x',\tau)\right\rangle$ or in the same way $R(x,x')=\frac{1}{N_{\tau}}\sum\limits_{j=1}^{N_t} w(x,\tau_j)w(x',\tau_j)$.
\end{itemize}

$R(x,x')_{x,x'}$, or $\mathcal{R}$, is the \emph{tensor of spatial correlations}. %
\ref{fred}, which is called Fredholm equation, can also be written :

\[\mathcal{R}\star_{\mathbf{x}}\phi_i=\lambda_i\phi_i\text{ where $\star_{\mathbf{x}}$ is the contracted product of $\mathcal{R}$ and $\phi_j$}\]

\etoile
When we do numerical calculus, the problem is formulated with a finite space $\Omega$, %
and the tensor $\mathcal{R}$ is a matrix of shape $N_x\times N_x$, $N_x :=|\Omega|$.

\par
The point is that, for practical purposes, $R(x,x')$ is a full-size matrix, with $N_x$ so large that the problem in $\lambda_i$ wouldn't be resolved ; %
this is the case in the problem of periodic homogenization.

\subsubsection{Method of snapshots}

In this paragraph, we make some hypotheses :

\begin{enumerate}[label=(Snap \arabic*)]
\item\label{hs1} $N_{\tau}\ll N_x$ ;
\item\label{hs2} The $w(\cdot , \tau_j)$ are linearly independent in $H$ ;
\item\label{hs3} For all $j$, $\phi_i(\mathbf{x})=\sum\limits_{j=1}^{N_{\tau}}\alpha_i(\tau_j) w(\mathbf{x},\tau_j)$.
\end{enumerate}

The spatial functions $w(\mathbf{x}, \tau_j)$ are called the \emph{snapshots}, a few of them should be enough to build a POD.

\par
Notice that the last hypothesis entails the POD basis contains a finite number $N_{POD}$ of vectors, and that $N_{POD}<N_{\tau}$.

\par
By construction, $\Phi$ depends on the data $w(\mathbf{x},\tau_j)$ and is'nt supposed to be universal, as can be the Fourier basis of a $\mathcal{L}^2$ space. %
Here, $\Phi$ is also supposed to be finite, and its cardinal is bounded by the size $N_{\tau}$ of the sample :

%\[\phi_i(\mathbf{x})=\sum\limits_{j=1}^{N_t}\alpha_i^j w(\mathbf{x},\tau_j)\]

Using Fubini theorem, Fredholm equation can be rewritten :

\begin{equation}\label{tenct}
\alpha_i\star_{\tau}\mathcal{C}\star_{\tau}w(\mathbf{x},\cdot)=\lambda_i\alpha_i\star_{\tau}w(\mathbf{x},\cdot)
\end{equation}

where :
\begin{itemize}
\item $\mathcal{C}$ is the temporal-correlation tensor : $\displaystyle C(\tau,\tau ')=\dfrac{1}{N_{\tau}}\int w(\mathbf{x},\tau)w(\mathbf{x},\tau')\text{d}\mathbf{x}$ ;
\item $\star_{\tau}$ is the contracted product, with respect to the parameter $\tau$ : here, an integral on $\tau$ is a finite sum $\sum\limits_{j=1}^{N_{\tau}}$.
\end{itemize}

Since \ref{hs2}, equation \ref{tenct} gives the following problem in $(\lambda_j , \alpha_j)$ :

\begin{equation}\label{tenct}
\mathcal{C}\star_{\tau}\alpha_i\mathbf=\lambda_i\alpha_i
\end{equation}

which is analogous to the linear-algebra problem we found in the last paragraph.

\par
The matrix $C(\tau_j,\tau_j^{'})$ is symmetric positive. Solutions $\alpha_i$ of the problem are, by consequence, %
orthogonal. Formula \ref{hs3} gives :

\[{\alpha^{\ast}}_j^i\phi_i(\cdot )=w(\cdot ,\tau_j)\text{ where ${\alpha^{\ast}}_j^i=\alpha_i(\tau_j)$}\]

Since now we write : $\alpha^{\ast}==a$, we obtain the time-dependent coefficient we were looking for in POD :

\[w(\mathbf{x},\tau_j)=\sum\limits_{i=1}^{N_{POD}}a_i(\tau_j)\phi_i(\mathbf{x})\text{ for all $\mathbf{x}$}\]

with $a_i(\tau_j)$ given by : $a_i(\tau_j)=\alpha_i (\tau_j)$.

\ligneinter
Some characteristics of the method of snapshots given in this paragraph then are :

\begin{itemize}
\item The basis $\Phi$ we obtain has a small number of components, equal to $N_{\tau}$ ;
\item $\Phi$ lies in the space generated by the snapshots ;
\item $\Phi$ is orthogonal and $(\phi_n |\phi_m)=\lambda_m\delta_{mn}$ for all $m$ and $n$ :
\item $\Phi$ satisfies the optimality condition for the POD in the space generated by the $w(\cdot , \tau_j)$, but isn't supposed to be universal for functions in the general $H$ ;
\item With this method, we obtain the $\tau-$ dependent coefficients $a_i$ or $\alpha_i$, then the POD basis. 
\end{itemize}

\subsubsection{Choosing a first few modes of a POD basis}

As the $\Phi$ found for POD is orthogonal, we can consider the question of the energy contained in a subset of the basis, %
in the sense of the norm - euclidean, $L^2$, $H^1$ \dots - of the projection on a subspace generated by this collection of spatial modes. %
Indeed, optimality of $\Phi$ entails that a first few vectors of the POD basis contain substantial information on the entire vamily, %
and then of the parametrized set of functions $w(\cdot ,\tau)_{\tau}$ of our physical problem.

\par
The following algorithm is the method of snapshots, combined with the choice of a first few vectors of the optimal orthogonal basis. %
The latter provides us the Reduced-Order Model, which matters in the next paragraph.

\begin{algo}\label{a_snap}
\begin{enumerate}
\item Select a sample $w(\mathbf{x},\tau_j)$ of $\mathbf{x}$-dependent functions, %
they can be experimental measurements or numerical simulation ;
\item Compute the \og{}time-\fg{} correlation matrix $C(\tau_j ,\tau_{j'})$ ;
\item Find the proper values and vectors of $[C]$, which is supposed to be small ;
\item\label{so1} Sort the proper-values $\lambda_i$ in a decreasing order ;
\item Compute the $\phi_i$ using the proper vectors found for $[C]$ ;
\item\label{so2} Evaluate the energy contained in each mode : $Ener^i:=\dfrac{\sum\limits_{k=1}^i\lambda_k}{\sum\limits_{k=1}^{N_{POD}}\lambda_k}$ ;
\item\label{so3} Choose the first $N_{rom}$ for which $Ener^i >\nu$, where $\nu$ is the energy threshold we want - typically, $99,99\%$ ;
\item\label{so4} Compute the approximation error with the subset $(\phi_i)_{i=1}^{N_{rom}}$.
\end{enumerate}
\end{algo}

The steps \ref{so1}, \ref{so2}, \ref{so3} and \ref{so4} have been added to the snapshot method. %
In practical purposes, $N$ will be small as a consequence of the optimality of $\Phi$. %
Thus, we obtain a decomposition that is not exact, but anyway very good, of our original sample with a \emph{reduced-order} orthogonal base.

\ligneinter
Let conclude that, when the function $w(\mathbf{x},\tau)$ satisfies a linear condition in $\mathbf{x}$, %
like a linear partial differential equation or a homogen boundary condition, %
we can put these functions in an Hilbert space which elements all satisfy the same relations, %
then the above reasonment leads us to build a basis $\Phi$ whose vectors are solutions of the same problem.

\subsection{A Reduced Order Model (ROM)}

We have written a sample of functions of space $w$, parametrized with a finite set of the real number $\tau$ :

\begin{equation}
w(\mathbf{x},\tau)\simeq\sum\limits_{i=1}^{N_{rom}} a_i(\tau)\phi_i(\mathbf{x})
\end{equation}

Now, suppose that $w(\mathbf{x},\tau)$ is solution to the problem :

\begin{equation}\label{genp}
\mathcal{A}^{\mathbf{x},\tau}\left(w(\mathbf{x},\tau)\right)=f(\mathbf{x},\tau)
\end{equation}

with $\mathcal{A}^{\mathbf{x},\tau}$ could be a differential operator, %
and $f$ a function, both depending on \emph{continuous} variables $\mathbf{x}$ and $\tau$.

\par
We write the general solution $w(\mathbf{x},\tau)$ of this problem in the same way as for the snapshots $w(\mathbf{x},\tau)$ :

\[w(\mathbf{x},\tau)=\sum\limits_{i=1}^{N_{rom}} a_i(\tau)\phi_i(\mathbf{x})+\mathcal{R}_N(\mathbf{x},\tau)\]

and we make the hypothesis that $\mathcal{R}(\mathbf{x},\tau)$ is orthogonal to the modes $\phi_i$ for all $\tau$.

\par
Galerkin projection along the $i-$th spatial mode of the problem \ref{genp} for $w$ is written :

\[%
\left(\left.\mathcal{A}\left(\sum\limits_{k=1}^{N_{rom}} a_k(\tau)\phi_k(\mathbf{x})\right) \right|\phi_i\left(\mathbf{x}\right)\right)_H %
= \left(f\left(\mathbf{x},\tau\right)|\phi_i(\mathbf{x})\right)_H%
\]

where $a_k-$s are $N_{rom}$ functions of the parameter $\tau$, solution of the so-called Reduced Order Model.

\par
Notice that the above projection of the strong problem \ref{genp} gives us a system of $N_{rom}$ equations, each involving the $N_{rom}$ coefficient functions $a_k$ %
that are known for the set of values $\tau_j$, which must be much easier to resolve than the original problem and will give us, %
in practical cases, a very good approximation of the parametrized function $w(\mathbf{x},\tau)$.

\par
We can also use Galerkin projection for a weak problem, that's we are doing in this work with \ref{chiw}.

\etoile
In this section, we define a ROM of the system \ref{chiw} using the so-called Galerkin projection on the basis $(\phi_i)_{i=1}^{N_{rom}}$.

One more step is however required for our purpose.

\par
Indeed, the snapshot $\chi_j$ that we use in our model construction is solution of \ref{chiw} on the fluid domain in %
the elementary cell defined with the geometrical parameter $\rho_j$, %
which we have seen can be the radius of an two-dimensional disc, an three-dimensional sphere etc. %
This disc, cylinder, \dots itself is a subset of the solid domain $\Omega_s$ of the inclusion.

\par
Thus, the function $\chi(\mathbf{x},\rho_j)$ is defined for $\mathbf{x}$ in a $\Omega_f$ space which depends on the parameter $\rho$.

\etoile
We begin the construction of our Reduced Order Model by extrapolating the snapshots $\chi(\mathbf{x},\rho_j)_j$, defined on the collection of domains $\Omega_f^j$, %
on a same functional space $H^0$, namely the space of functions defined on the fluid domain $\Omega_f^0$ which satisfies $\rho=0$, %
with the norm used for the spaces of the snapshots ; %
the Hilbert space $H^0$ which appears in the prewious paragraph is typically $\mathcal{L}^2\left(\Omega_f^{\rho=0}\right)$.

\par
Then we compute a POD basis $\phi_i^0(\mathbf{y})$, for $\mathbf{y}$ in $\Omega_f^0$, with algorithm \ref{a_snap}. %
The $\phi_j$ modes will satisfy the partial differential equation \ref{chiw} ; %with the periodicity and average value condition.
they will also satisfy periodicity and mean-value conditions of strong problem \ref{chistr} if they are regular enough.

\etoile
Once we have computed the POD basis, and chosen the smallest number $N_{rom}$ of modes for which energy exceeds $99,99\%$ of all spatial modes $\phi_i$. %
Let us write :

\[\chi^0\left(\mathbf{y},\rho\right)\text{ for all $\mathbf{y}$ in the fluid domain $\Omega_f^0$ and all meaningful $\rho$}\]

\par
Galerkin projection of \ref{chiw}, with respect to the components of the test vector field $v(\mathbf{y})$, is written :

\begin{equation}\label{morchiz}
\sum\limits_{k=1}^{N_{rom}} a_k(\rho)\int\limits_{\Omega}Tr\left(\langle grad_y\phi_k^0 \left(\mathbf{y},\rho\right)|grad_y\left(\phi_i^0(\mathbf{y}\right)\rangle\right)\text{d}\Omega+%
\int\limits_{\Gamma_{sf}}\langle n_{sf}|\phi_i^0(\mathbf{y})\rangle \text{d}s %
=0
\end{equation}

where $\langle |\rangle$ is the scalar product in the two- or three-dimensional space which contains the elementary cell.

\par
This problem is simple because it is linear and involves a small number of $a_k$ functions.%, and can be resolved with any programming language with a reasonable linear algebra library. %
%In this work we will use the numpy module of Python3, so we can directly use the snapshots computed with FEniCS.

%\par
%Solutions $a_k(\rho)$, for $k$ from $1$ to $N$, are used to construct a $\chi^0\left(\mathbf{y},\rho\right)$ function of the spatial variable $\mathbf{y}$, %
%on the artificial fluid domain $\Omega_f^0$, for each possible $\rho$ characterizing an elemntary cell with solid inclusion.

\etoile
However, our approach is a little different because the meaningful fluid domain, for a given parameter $\rho$, %
is not $\Omega^0$ but includes, as a part of the cell's solid domain, an area or volume depending on the value of $\rho$, %
which is not zero.

\par
Let now $\rho^{new}$ be an a parameter, which is not one of the $\rho_j$ parameters of the snapshots, %
we want to compute $\chi(\mathbf{y},\rho^{new})$ in the fluid domain $\Omega_f^{new}$ of the cell with solid inclusion of size $\rho^{new}$.

\par
We begin with extrapolating the modes $\phi_i^0(\mathbf{y})$, defined for $\mathbf{y}$ in the fluid domain $\Omega_f^0$. %
In this purpose, we simply inverse the transformation, from the functional space $H^{new}$ to $H^0$, %
analogous to the interpolation that has been unsed to map the $\chi(\cdot,\rho_j)$ to the POD-relevant snapshots $\chi (\cdot ,\rho_j)$.

\par
We resolve the \ref{morchiz} look-alike system with the basis $(\phi_i^{new})_i$ obtained with this transformation :

\begin{equation}
\sum\limits_{k=1}^{N_{rom}} a_k(\rho^{new})\int\limits_{\Omega}Tr\left(\langle grad_y\phi_k^{new} \left(\mathbf{y},\rho\right)|grad_y\left(\phi_i^{new}(\mathbf{y}\right)\rangle\right)\text{d}\Omega+%
\int\limits_{\Gamma_{sf}}\langle n_{sf}|\phi_i^{new}(\mathbf{y})\rangle \text{d}s %
=0
\label{morchi}
\end{equation}

and obtain the physically-relevant $a_k -$s, which are not the same than in \ref{morchiz}.

\par
The $\chi(\mathbf{y},\rho^{new})$ we were looking for is simply the linear combination of the $\phi_i^{new}$ given by the truncated POD :

\begin{equation}\label{newrom}
\chi\left(\mathbf{y},\rho^{new}\right)\simeq \sum\limits_{i=1}^{N_{rom}} a_i \left(\rho^{new}\right)\phi_i^{new}(\mathbf{y})\text{ for all $\mathbf{y}$ in $\Omega_f^{new}$}
\end{equation}

\par
If we write problem \ref{morchi} with the vector functions we compute with FEniCS, %
we get a discrete and linear problem in the $a_i-$s for any $\rho^{new}$ ; %
in this work we use the numpy module of Python3 for this purpose, thus we can immediately use the results from FEniCS.

\par
We use the reduced order model the next section to compute numerically the vector $\chi$ in the configurations seen in section \ref{hom_d}, %
varying the parameter $\rho$ ; we also give the values of the homogenized tensor obtained with the reduced model.

\par
Afterwards we compare performances and accuracy of the method, with the computation of the same $\chi$ and diffusion tensor using the Finite Element Method.

\par
Let us summarize the steps we follow in this work, and that we implement with Python3 and FEniCS.

\begin{algo}\label{a_rom}
\begin{enumerate}[label=\textbf{S \hspace{-7pt} \Roman*}]
\item Compute the $\chi\left(\mathbf{y},\rho_j\right)$ vector fields in $\mathbf{y}$, for a finite and small number of parameters $\rho_j$, %
using Finite Element Method ;
\item Map the $\chi (\cdot,\rho_j)$ from their respective fluid domain to the single $\Omega_f^0$, we obtain a collection of snapshots $(\chi^0(\mathbf{y},\rho_j)$ %
defined for $\mathbf{y}$ in $\Omega_f^0$ ;
\item With algorithm \ref{a_snap}, compute the $\phi^0_i$, for integer $i$ between $1$ and some $N_{rom}$ depending on the energy fraction we want for our model, typically $99,99\%$ ;
\item Reduced Order Model : we choose a new parameter $\rho^{new}$.
\begin{enumerate}[label=(\textbf{se}\ \roman*)]
\item Map the $\phi_i^0$ to the space $H^{new}$ of functions defined on the domain $\Omega_f^{new}$, with the norm $L^2$, $H^1$ etc we have chosen for our work ;
\item Resolve the Reduced Order Model with the modes $\phi_i^{new}$ and obtain the expression of $a_i(\rho)$, for every real parameter $\rho$ ;
\item Compute $\chi(\mathbf{y},\rho^{new})$ using formula \ref{newrom} ;
\item Integrate the vector field on domain $\Omega_f^{new}$ to obtain $D_k^{hom-new}$ ;
\item[Optional] Compare performances with the computation of $\chi(\mathbf{y},\rho^{new})$ using Finite Element Method : %
time of execution, accuracy.
\end{enumerate}
\end{enumerate}
\end{algo}

For practical purpose, the first three steps will be executed offline, with a sample of microstructures not relevant for the situation. %
The last step consists in the computation online, which is supposed to be fast thanks to the Reduced Order Model, %
of an homogenized property, here the difffusion tensor, wanted for a given cemtarious material.
The calculus using the time-expensive, Finite Element Mehod, is performed once and for all.